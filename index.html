<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetireSaathi - Your Future Lifestyle Simulator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for text, Poppins for headings for a modern feel -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to right bottom, #fcf6f0, #ffeccb); /* Soft, warm gradient */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        h1, h2, h3, .poppins {
            font-family: 'Poppins', sans-serif;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Softer shadow */
            padding: 2.5rem;
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Input specific styling */
        input[type="number"], select {
            background-color: #f8fafc; /* bg-gray-50 */
            border-color: #cbd5e1; /* border-gray-300 */
            transition: all 0.2s ease-in-out;
        }
        input[type="number"]:focus, select:focus {
            ring-color: #f97316; /* orange-500 */
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2); /* Custom ring shadow */
        }
        button {
            transition: all 0.2s ease-in-out;
            transform: scale(1);
        }
        button:hover {
            transform: scale(1.02);
        }

        /* Styling for range inputs */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #cbd5e1; /* gray-300 */
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f97316; /* orange-500 */
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #f97316; /* orange-500 */
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0; /* gray-200 */
            border-radius: 9999px;
            height: 18px; /* Slightly slimmer */
            overflow: hidden;
            margin-top: 1rem;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(to right, #4ade80, #16a34a); /* green-400 to green-600 */
            width: 0%;
            border-radius: 9999px;
            transition: width 0.7s cubic-bezier(0.25, 0.8, 0.25, 1.0); /* Smoother animation */
        }
        .progress-bar-danger {
            background: linear-gradient(to right, #f87171, #ef4444); /* red-400 to red-600 */
        }
        .progress-bar-warning {
            background: linear-gradient(to right, #fbbf24, #f59e0b); /* amber-400 to amber-600 */
        }

        /* Bar Chart Styling */
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 180px; /* Taller chart */
            border-bottom: 2px solid #e2e8f0; /* Lighter border */
            padding-bottom: 1.5rem;
            gap: 0.5rem; /* More space between bars */
            position: relative; /* For absolute positioning of values/labels */
        }
        .chart-bar {
            flex-grow: 1;
            background: linear-gradient(to top, #60a5fa, #3b82f6); /* blue-400 to blue-600 */
            transition: height 0.7s cubic-bezier(0.25, 0.8, 0.25, 1.0);
            border-radius: 0.5rem 0.5rem 0 0; /* Rounded top corners only */
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        .chart-bar-value {
            font-size: 0.75rem; /* text-xs */
            color: #ffffff;
            font-weight: 600;
            padding-bottom: 0.25rem;
            position: absolute;
            top: -1.5rem; /* Position above the bar */
            white-space: nowrap;
        }
        .chart-bar-label {
            font-size: 0.875rem; /* text-sm */
            color: #4a5568; /* gray-700 */
            text-align: center;
            position: absolute;
            bottom: -2.5rem; /* Below the chart */
            width: 100%;
            font-weight: 500;
        }

        .scenario-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            background-color: #fbf7ed; /* Light orange tint */
            padding: 0.75rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .scenario-item span {
            font-size: 1.5rem; /* Larger emoji */
        }
        .scenario-item p {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #4a5568;
        }

        /* Card Styling for Lifestyle Choices */
        .choice-card {
            border: 2px solid #e2e8f0; /* gray-200 */
            border-radius: 0.75rem; /* rounded-xl */
            cursor: pointer;
            overflow: hidden;
            transition: all 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* Distribute content */
            text-align: center;
            padding-bottom: 0.5rem; /* Space for text below image */
            background-color: #fbfbfc; /* Slightly off-white for cards */
            height: 160px; /* Fixed height for smaller cards */
            position: relative; /* For hover-list positioning */
        }
        .choice-card:hover {
            border-color: #f97316; /* orange-500 */
            box-shadow: 0 4px 10px rgba(249, 115, 22, 0.2);
            transform: translateY(-2px);
        }
        .choice-card.selected {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }
        .choice-card img {
            width: 100%;
            height: 90px; /* Consistent height for images */
            object-fit: cover;
            border-radius: 0.75rem 0.75rem 0 0; /* Match card border radius */
        }
        .choice-card-content {
            padding: 0.5rem 0.25rem; /* Adjust padding for content inside card */
        }
        .choice-card-title {
            font-weight: 600;
            margin-top: 0.25rem; /* Reduced margin */
            color: #374151; /* gray-700 */
            font-size: 0.9rem; /* Slightly smaller title font */
        }
        .choice-card-description {
            font-size: 0.7rem; /* text-xs */
            color: #6b7280; /* gray-500 */
            margin-top: 0.1rem; /* Reduced margin */
        }
        /* Grid adjustments for smaller cards */
        #city-selection.grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        #travel-selection.grid, #dining-selection.grid, #hobbies-selection.grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }

        /* Hover List Styling */
        .hover-list {
            position: absolute;
            top: 0;
            left: 100%; /* Position to the right of the card */
            width: 180px; /* Fixed width for the list */
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transform: translateX(10px); /* Slightly move right for slide-in effect */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s;
            text-align: left; /* Align text inside the list */
        }
        .choice-card:hover .hover-list {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }
        .hover-list strong {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
        }
        .hover-list ul {
            list-style: none; /* Remove default list bullets */
            padding: 0;
            margin: 0;
            max-height: 150px; /* Limit height */
            overflow-y: auto; /* Enable scrolling for long lists */
        }
        .hover-list li {
            font-size: 0.8rem;
            color: #4a5568;
            padding: 0.2rem 0;
            border-bottom: 1px dotted #e2e8f0; /* Subtle separator */
        }
        .hover-list li:last-child {
            border-bottom: none;
        }

        /* Investment Option Cards */
        .investment-card {
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem;
            text-align: center;
            background-color: #fcfcfc;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .investment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .investment-card img {
            width: 60px; /* Smaller image */
            height: 60px;
            object-fit: contain;
            margin: 0 auto 0.5rem;
        }
        .investment-card-title {
            font-weight: 600;
            font-size: 0.875rem; /* text-sm */
            color: #374151;
            margin-bottom: 0.25rem;
        }
        .investment-card-value {
            font-weight: 700;
            font-size: 1rem; /* text-base */
            color: #16a34a; /* green-600 */
        }
        .investment-card-button {
            margin-top: 0.75rem;
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 0.5rem;
            background-color: #f97316;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .investment-card-button:hover {
            background-color: #ea580c;
        }
        .marketplace-result {
            background-color: #ecfdf5; /* green-50 */
            border: 1px solid #a7f3d0; /* green-200 */
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #065f46; /* green-800 */
            line-height: 1.4;
        }


        @media (max-width: 768px) { /* Adjust for smaller screens */
            .card {
                padding: 1.5rem;
                grid-template-columns: 1fr;
            }
            #city-selection.grid, #travel-selection.grid, #dining-selection.grid, #hobbies-selection.grid {
                grid-template-columns: repeat(2, minmax(0, 1fr)); /* 2 columns on mobile */
            }
            .choice-card {
                height: 140px; /* Adjust height for smaller screens */
            }
            .choice-card img {
                height: 70px;
            }
            /* Adjust hover list positioning for mobile if it's awkward */
            .hover-list {
                left: 0; /* Re-position to left edge of card */
                top: 100%; /* Position below the card */
                transform: translateY(10px);
            }
            .choice-card:hover .hover-list {
                transform: translateY(0);
            }
        }

    </style>
</head>
<body class="flex flex-col min-h-screen items-center justify-center">
    <div class="container mx-auto p-6 md:p-10 lg:p-12 card w-full max-w-4xl grid md:grid-cols-2 gap-10">
        <!-- Inputs Column -->
        <div class="space-y-6">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-6 poppins">Future You. Unlocked. ✨</h1>
            <p class="text-gray-600 mb-8">Craft your dream retirement lifestyle and see the financial roadmap come alive!</p>

            <h3 class="text-2xl font-semibold text-orange-600 border-b-2 border-orange-200 pb-2 mb-4 poppins">Your Financial Blueprint</h3>

            <div>
                <label for="current-age" class="block text-gray-700 text-sm font-medium mb-1">Your Current Age:</label>
                <input type="range" id="current-age" value="40" min="20" max="60" step="1" class="w-full">
                <span id="current-age-value" class="text-gray-800 text-sm font-semibold">40 years</span>
            </div>
            <div>
                <label for="retirement-age" class="block text-gray-700 text-sm font-medium mb-1">Desired Retirement Age:</label>
                <input type="range" id="retirement-age" value="60" min="60" max="75" step="1" class="w-full">
                <span id="retirement-age-value" class="text-gray-800 text-sm font-semibold">60 years</span>
            </div>
            <div>
                <label for="life-expectancy" class="block text-gray-700 text-sm font-medium mb-1">Life Expectancy:</label>
                <input type="range" id="life-expectancy" value="85" min="75" max="100" step="1" class="w-full">
                <span id="life-expectancy-value" class="text-gray-800 text-sm font-semibold">85 years</span>
            </div>
            <div>
                <label for="monthly-expenses" class="block text-gray-700 text-sm font-medium mb-1">Current Monthly Expenses (₹):</label>
                <input type="range" id="monthly-expenses" value="50000" min="10000" max="200000" step="5000" class="w-full">
                <span id="monthly-expenses-value" class="text-gray-800 text-sm font-semibold">₹50,000</span>
            </div>
            <div>
                <label for="existing-corpus" class="block text-gray-700 text-sm font-medium mb-1">Existing Retirement Savings (₹):</label>
                <input type="range" id="existing-corpus" value="2000000" min="0" max="10000000" step="500000" class="w-full">
                <span id="existing-corpus-value" class="text-gray-800 text-sm font-semibold">₹2,000,000</span>
            </div>

            <h3 class="text-2xl font-semibold text-orange-600 border-b-2 border-orange-200 pb-2 mb-4 mt-8 poppins">Your Dream Lifestyle 🌟</h3>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2">Desired Retirement City/Region:</label>
                <div id="city-selection" class="grid grid-cols-2 gap-4">
                    <div class="choice-card" data-value="bengaluru">
                        <img src="https://placehold.co/100x90/581c87/FFF?text=CityLife" alt="Cityscape">
                        <div class="choice-card-content">
                            <div class="choice-card-title">City</div>
                            <div class="choice-card-description">Vibrant Urban Living</div>
                        </div>
                        <div class="hover-list">
                            <strong>Top City Retreats:</strong>
                            <ul>
                                <li>Mumbai</li>
                                <li>Delhi</li>
                                <li>Bengaluru</li>
                                <li>Chennai</li>
                                <li>Hyderabad</li>
                                <li>Kolkata</li>
                                <li>Ahmedabad</li>
                                <li>Pune</li>
                                <li>Surat</li>
                                <li>Jaipur</li>
                            </ul>
                        </div>
                    </div>
                    <div class="choice-card" data-value="goa">
                        <img src="https://placehold.co/100x90/0d9488/FFF?text=Beaches" alt="Beach Scene">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Beach</div>
                            <div class="choice-card-description">Coastal Paradise</div>
                        </div>
                        <div class="hover-list">
                            <strong>Popular Beach Destinations:</strong>
                            <ul>
                                <li>Goa</li>
                                <li>Pondicherry</li>
                                <li>Kerala Coast</li>
                                <li>Andaman & Nicobar</li>
                                <li>Vizag</li>
                                <li>Alibaug</li>
                                <li>Gokarna</li>
                                <li>Puri</li>
                                <li>Digha</li>
                                <li>Murudeshwar</li>
                            </ul>
                        </div>
                    </div>
                    <div class="choice-card" data-value="pune">
                        <img src="https://placehold.co/100x90/16a34a/FFF?text=Balanced" alt="Suburban Park">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Balanced Living</div>
                            <div class="choice-card-description">Tier-2 City Charm</div>
                        </div>
                         <div class="hover-list">
                            <strong>Ideal Balanced Cities:</strong>
                            <ul>
                                <li>Pune</li>
                                <li>Chandigarh</li>
                                <li>Bhubaneswar</li>
                                <li>Coimbatore</li>
                                <li>Indore</li>
                                <li>Kochi</li>
                                <li>Lucknow</li>
                                <li>Nagpur</li>
                                <li>Vadodara</li>
                                <li>Visakhapatnam</li>
                            </ul>
                        </div>
                    </div>
                    <div class="choice-card" data-value="small-town">
                        <img src="https://placehold.co/100x90/3b82f6/FFF?text=Mountains" alt="Mountain Landscape">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Mountains</div>
                            <div class="choice-card-description">Peaceful Hill Retreat</div>
                        </div>
                        <div class="hover-list">
                            <strong>Serene Mountain Escapes:</strong>
                            <ul>
                                <li>Shimla</li>
                                <li>Manali</li>
                                <li>Darjeeling</li>
                                <li>Ooty</li>
                                <li>McLeod Ganj</li>
                                <li>Rishikesh</li>
                                <li>Munnar</li>
                                <li>Kodaikanal</li>
                                <li>Mussoorie</li>
                                <li>Nainital</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2">Wanderlust Level:</label>
                <div id="travel-selection" class="grid grid-cols-3 gap-4">
                    <div class="choice-card" data-value="low">
                        <img src="https://placehold.co/100x90/fbbf24/000?text=Local" alt="Local Park/Monument">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Local Gems</div>
                            <div class="choice-card-description">Stay Close</div>
                        </div>
                    </div>
                    <div class="choice-card" data-value="medium">
                        <img src="https://placehold.co/100x90/f97316/FFF?text=India" alt="Indian Map">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Domestic</div>
                            <div class="choice-card-description">Explore India ✈️</div>
                        </div>
                    </div>
                    <div class="choice-card" data-value="high">
                        <img src="https://placehold.co/100x90/ef4444/FFF?text=Global" alt="Globe/Airplane">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Global</div>
                            <div class="choice-card-description">World Adventurer 🌍</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2">Foodie & Social Scene:</label>
                <div id="dining-selection" class="grid grid-cols-3 gap-4">
                    <div class="choice-card" data-value="low">
                        <img src="https://placehold.co/100x90/c026d3/FFF?text=Home" alt="Cozy Home Interior">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Homebody</div>
                            <div class="choice-card-description">Cozy Nights In</div>
                        </div>
                    </div>
                    <div class="choice-card" data-value="medium">
                        <img src="https://placehold.co/100x90/eab308/FFF?text=Cafe" alt="Coffee Cup / Cafe Scene">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Cafe Hopper</div>
                            <div class="choice-card-description">Weekly Outings</div>
                        </div>
                    </div>
                    <div class="choice-card" data-value="high">
                        <img src="https://placehold.co/100x90/f43f5e/FFF?text=Dine" alt="Fine Dining Plate">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Fine Dining</div>
                            <div class="choice-card-description">Gourmet Explorer</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-medium mb-2">Passion Pursuits:</label>
                <div id="hobbies-selection" class="grid grid-cols-3 gap-4">
                    <div class="choice-card" data-value="low">
                        <img src="https://placehold.co/100x90/64748b/FFF?text=Relax" alt="Reading Book / TV Remote">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Relaxed</div>
                            <div class="choice-card-description">Chill & Unwind</div>
                        </div>
                    </div>
                    <div class="choice-card" data-value="medium">
                        <img src="https://placehold.co/100x90/22c55e/FFF?text=Active" alt="Person Exercising">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Active</div>
                            <div class="choice-card-description">Fitness & Clubs</div>
                        </div>
                    </div>
                    <div class="choice-card" data-value="high">
                        <img src="https://placehold.co/100x90/8b5cf6/FFF?text=Create" alt="Art Supplies / Laptop Coding">
                        <div class="choice-card-content">
                            <div class="choice-card-title">Immersive</div>
                            <div class="choice-card-description">Create & Grow</div>
                        </div>
                    </div>
                </div>
            </div>

            <button id="simulate-lifestyle-btn" class="w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white font-semibold rounded-full shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-orange-300 transform active:scale-98">
                Simulate My Future! ✨
            </button>
        </div>

        <!-- Output Column -->
        <div id="simulation-output" class="space-y-8 bg-orange-50 p-6 md:p-8 rounded-2xl shadow-inner border border-orange-200 hidden">
            <h3 class="text-3xl font-extrabold text-gray-800 border-b-2 border-green-400 pb-3 mb-6 poppins">Your Retirement Reality Check 🚀</h3>

            <div class="bg-white p-5 rounded-xl shadow-md flex justify-between items-center">
                <div>
                    <p class="text-lg font-medium text-gray-700 mb-1">Corpus Needed for Your Dream:</p>
                    <p id="corpus-needed" class="text-4xl font-bold text-green-700 poppins">₹0 Crore</p>
                </div>
                <span class="text-5xl">💰</span>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-md flex justify-between items-center">
                <div>
                    <p class="text-lg font-medium text-gray-700 mb-1">Your Projected Corpus at 60:</p>
                    <p id="projected-corpus" class="text-4xl font-bold text-blue-700 poppins">₹0 Crore</p>
                </div>
                <span class="text-5xl">📈</span>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-md">
                <p class="text-lg font-medium text-gray-700 mb-2">Funds Projected to Last Until Age:</p>
                <p id="funds-last-until" class="text-3xl font-bold text-gray-800 poppins">--</p>
                <div class="progress-bar-container">
                    <div id="corpus-health-bar" class="progress-bar-fill"></div>
                </div>
                <p id="corpus-health-text" class="text-sm mt-2 font-medium text-gray-600 text-center">Corpus Health: Calculating...</p>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-md">
                <h4 class="text-xl font-semibold text-gray-800 mb-4 poppins">Monthly Expense Map 🗺️</h4>
                <div class="chart-container" id="expense-chart">
                    <!-- Bars will be dynamically generated here -->
                </div>
                <div class="flex flex-wrap justify-around text-xs mt-4 text-gray-600" id="expense-labels-container">
                    <!-- Labels will be dynamically generated here to prevent overlap with bars -->
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-md">
                <h4 class="text-xl font-semibold text-gray-800 mb-4 poppins">A Glimpse into Your Day: 🌅</h4>
                <div id="retirement-day-scenario" class="text-gray-700 space-y-3">
                    <!-- Scenario will be dynamically generated here -->
                </div>
            </div>

            <div id="ai-nudge-area" class="bg-blue-100 p-5 rounded-xl shadow-sm border border-blue-200 text-blue-800 hidden">
                <p class="font-semibold text-lg poppins mb-2">RetireSaathi Insight: ✨</p>
                <p id="ai-nudge-text" class="text-sm leading-relaxed"></p>

                <h4 class="font-semibold text-lg poppins mt-6 mb-4">Bridge Your Gap with Smart Investments:</h4>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4" id="investment-options-container">
                    <!-- Investment cards will be dynamically generated here -->
                </div>
                <button id="auto-adjust-allocation-btn" class="mt-6 w-full px-4 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 transition-colors duration-200">
                    Auto-Adjust My Allocation
                </button>
                <div id="marketplace-results-display" class="marketplace-result hidden">
                    <!-- Marketplace results will display here -->
                </div>
                <p class="text-xs text-blue-600 italic mt-3">Disclaimer: This simulation is for educational purposes only and not financial advice. Consult a certified financial advisor for personalized recommendations.</p>
            </div>
        </div>
    </div>

    <script>
        // --- Global Variables and Constants ---
        const INFLATION_RATE = 0.05; // 5% annual inflation
        const PRE_RETIREMENT_RETURN_RATE = 0.10; // 10% annual return
        const POST_RETIREMENT_RETURN_RATE = 0.06; // 6% annual return in retirement
        const SAFETY_FACTOR = 1.15; // Add 15% for contingency/buffer

        // Base costs and multipliers for lifestyle (simplified for prototype)
        const CITY_COST_MULTIPLIERS = {
            'bengaluru': 1.0,
            'goa': 0.85,
            'pune': 0.75,
            'small-town': 0.60 /* Now 'Mountains' but using same multiplier for demo */
        };

        const LIFESTYLE_COST_IMPACTS = {
            'travel': { 'low': 0.05, 'medium': 0.15, 'high': 0.25 }, // % of base expenses
            'dining-out': { 'low': 0.05, 'medium': 0.10, 'high': 0.15 },
            'hobbies-level': { 'low': 0.03, 'medium': 0.08, 'high': 0.12 }
        };
        const BASE_EXPENSE_PROPORTIONS = { // Proportions of initial base monthly expenses
            'Housing': 0.30,
            'Food & Groceries': 0.20,
            'Utilities & Transport': 0.10,
            'Healthcare Buffer': 0.15,
            'Miscellaneous': 0.05
        };

        // --- Helper Functions ---
        function calculateFutureValue(presentValue, annualRate, years) {
            return presentValue * Math.pow(1 + annualRate, years);
        }

        function formatCurrency(amount) {
            // Converts to Crore if > 1 Crore, otherwise Lakhs, or just Rupees
            if (amount >= 10000000) {
                return `₹${(amount / 10000000).toFixed(2)} Crore`;
            } else if (amount >= 100000) {
                return `₹${(amount / 100000).toFixed(2)} Lakhs`;
            } else {
                return `₹${Math.round(amount).toLocaleString('en-IN')}`;
            }
        }
        function formatRupees(amount) {
            return `₹${Math.round(amount).toLocaleString('en-IN')}`;
        }

        // --- DOM Elements ---
        const simulateBtn = document.getElementById('simulate-lifestyle-btn');
        const simulationOutput = document.getElementById('simulation-output');

        // Input Sliders
        const currentAgeInput = document.getElementById('current-age');
        const retirementAgeInput = document.getElementById('retirement-age');
        const lifeExpectancyInput = document.getElementById('life-expectancy');
        const monthlyExpensesInput = document.getElementById('monthly-expenses');
        const existingCorpusInput = document.getElementById('existing-corpus');

        // Output Value Spans for Sliders
        const currentAgeValueSpan = document.getElementById('current-age-value');
        const retirementAgeValueSpan = document.getElementById('retirement-age-value');
        const lifeExpectancyValueSpan = document.getElementById('life-expectancy-value');
        const monthlyExpensesValueSpan = document.getElementById('monthly-expenses-value');
        const existingCorpusValueSpan = document.getElementById('existing-corpus-value');

        // Card Selection Containers
        const citySelectionContainer = document.getElementById('city-selection');
        const travelSelectionContainer = document.getElementById('travel-selection');
        const diningSelectionContainer = document.getElementById('dining-selection');
        const hobbiesSelectionContainer = document.getElementById('hobbies-selection');

        // Output Display Elements
        const corpusNeededElem = document.getElementById('corpus-needed');
        const projectedCorpusElem = document.getElementById('projected-corpus');
        const fundsLastUntilElem = document.getElementById('funds-last-until');
        const corpusHealthBar = document.getElementById('corpus-health-bar');
        const corpusHealthText = document.getElementById('corpus-health-text');
        const expenseChart = document.getElementById('expense-chart');
        const expenseLabelsContainer = document.getElementById('expense-labels-container');
        const retirementDayScenario = document.getElementById('retirement-day-scenario');
        const aiNudgeArea = document.getElementById('ai-nudge-area');
        const aiNudgeText = document.getElementById('ai-nudge-text');

        // Investment Nudge Elements
        const investmentOptionsContainer = document.getElementById('investment-options-container');
        const autoAdjustAllocationBtn = document.getElementById('auto-adjust-allocation-btn');
        const marketplaceResultsDisplay = document.getElementById('marketplace-results-display');


        // --- Card Selection Logic ---
        function setupCardSelection(containerId, initialValue) {
            const container = document.getElementById(containerId);
            let currentValue = initialValue;

            // Mark initial selection
            const initialCard = container.querySelector(`.choice-card[data-value="${initialValue}"]`);
            if (initialCard) {
                initialCard.classList.add('selected');
            }

            container.addEventListener('click', (event) => {
                const clickedCard = event.target.closest('.choice-card');
                if (clickedCard && !clickedCard.classList.contains('selected')) {
                    // Deselect previous
                    const previouslySelected = container.querySelector('.choice-card.selected');
                    if (previouslySelected) {
                        previouslySelected.classList.remove('selected');
                    }
                    // Select new
                    clickedCard.classList.add('selected');
                    currentValue = clickedCard.dataset.value;
                    updateSimulation(); // Trigger simulation update on card change
                }
            });
            return {
                getValue: () => currentValue
            };
        }

        // Initialize card selectors
        const citySelector = setupCardSelection('city-selection', 'bengaluru');
        const travelSelector = setupCardSelection('travel-selection', 'medium');
        const diningSelector = setupCardSelection('dining-selection', 'medium');
        const hobbiesSelector = setupCardSelection('hobbies-selection', 'medium');

        // --- Core Simulation Logic ---
        function updateSimulation() {
            // Update slider value displays
            currentAgeValueSpan.textContent = `${currentAgeInput.value} years`;
            retirementAgeValueSpan.textContent = `${retirementAgeInput.value} years`;
            lifeExpectancyValueSpan.textContent = `${lifeExpectancyInput.value} years`;
            monthlyExpensesValueSpan.textContent = formatRupees(monthlyExpensesInput.value);
            existingCorpusValueSpan.textContent = formatRupees(existingCorpusInput.value);

            // Get input values
            const currentAge = parseInt(currentAgeInput.value);
            const retirementAge = parseInt(retirementAgeInput.value);
            const lifeExpectancy = parseInt(lifeExpectancyInput.value);
            const currentMonthlyExpenses = parseFloat(monthlyExpensesInput.value);
            const existingCorpus = parseFloat(existingCorpusInput.value);

            // Get selected card values
            const cityChoice = citySelector.getValue();
            const travelFrequency = travelSelector.getValue();
            const diningOut = diningSelector.getValue();
            const hobbiesLevel = hobbiesSelector.getValue();

            // Basic Validation for core logic
            if (currentAge <= 0 || retirementAge <= currentAge || lifeExpectancy <= retirementAge || currentMonthlyExpenses <= 0) {
                simulationOutput.classList.add('hidden');
                return;
            }

            simulationOutput.classList.remove('hidden'); // Ensure output area is visible

            const yearsToRetirement = retirementAge - currentAge;
            const yearsInRetirement = lifeExpectancy - retirementAge;

            // 1. Calculate projected monthly expenses in retirement (future value of current expenses)
            let futureMonthlyBaseExpenses = calculateFutureValue(currentMonthlyExpenses, INFLATION_RATE, yearsToRetirement);

            // Adjust for city cost multiplier
            futureMonthlyBaseExpenses *= CITY_COST_MULTIPLIERS[cityChoice];

            // Calculate lifestyle specific costs based on a proportion of this *adjusted* base expense
            const travelCostAmount = futureMonthlyBaseExpenses * LIFESTYLE_COST_IMPACTS.travel[travelFrequency];
            const diningOutCostAmount = futureMonthlyBaseExpenses * LIFESTYLE_COST_IMPACTS['dining-out'][diningOut];
            const hobbiesCostAmount = futureMonthlyBaseExpenses * LIFESTYLE_COST_IMPACTS['hobbies-level'][hobbiesLevel];

            // Sum up total projected monthly expenses for retirement
            const projectedMonthlyExpensesRetired = (
                futureMonthlyBaseExpenses * (BASE_EXPENSE_PROPORTIONS.Housing + BASE_EXPENSE_PROPORTIONS['Food & Groceries'] + BASE_EXPENSE_PROPORTIONS['Utilities & Transport'] + BASE_EXPENSE_PROPORTIONS['Healthcare Buffer'] + BASE_EXPENSE_PROPORTIONS.Miscellaneous) +
                travelCostAmount + diningOutCostAmount + hobbiesCostAmount
            ) * SAFETY_FACTOR; // Apply safety factor to the total

            const projectedAnnualExpensesRetired = projectedMonthlyExpensesRetired * 12;

            // 2. Calculate Required Corpus (Corpus Needed)
            const safeWithdrawalRate = 0.04; // Simplified 4% rule.
            const corpusNeeded = projectedAnnualExpensesRetired / safeWithdrawalRate;

            // 3. Calculate Projected Corpus at Retirement (based on existing savings growth)
            const projectedCorpus = calculateFutureValue(existingCorpus, PRE_RETIREMENT_RETURN_RATE, yearsToRetirement);

            // 4. Calculate Funds Last Until Age (longevity)
            let remainingCorpus = projectedCorpus;
            let actualYearsLasting = retirementAge;
            let fundsRunOut = false;

            for (let year = 0; year <= yearsInRetirement + 15; year++) { // Check well beyond life expectancy
                let expensesThisYear = projectedAnnualExpensesRetired * Math.pow(1 + INFLATION_RATE, year);
                remainingCorpus = remainingCorpus * (1 + POST_RETIREMENT_RETURN_RATE) - expensesThisYear;
                if (remainingCorpus <= 0) {
                    actualYearsLasting = retirementAge + year;
                    fundsRunOut = true;
                    break;
                } else {
                    actualYearsLasting = retirementAge + year + 1; // Continues to last
                }
            }

            if (!fundsRunOut && actualYearsLasting >= lifeExpectancy) {
                fundsLastUntilElem.innerHTML = `${lifeExpectancy} (and beyond! 🥳)`;
            } else if (fundsRunOut) {
                fundsLastUntilElem.innerHTML = `${actualYearsLasting} 😔`;
            } else { // Fallback, should ideally not be hit
                fundsLastUntilElem.innerHTML = `Error calculating longevity.`;
            }

            // Update UI elements
            corpusNeededElem.textContent = formatCurrency(corpusNeeded);
            projectedCorpusElem.textContent = formatCurrency(projectedCorpus);

            // Update Corpus Health Bar
            let healthPercentage = Math.min(100, (projectedCorpus / corpusNeeded) * 100);
            corpusHealthBar.style.width = `${healthPercentage}%`;
            corpusHealthBar.classList.remove('progress-bar-danger', 'progress-bar-warning'); // Reset classes

            let healthStatusText = "On Track! Awesome! 💪";
            if (healthPercentage < 50) {
                corpusHealthBar.classList.add('progress-bar-danger');
                healthStatusText = "Significant Gap! Time to boost savings! 🚨";
            } else if (healthPercentage < 80) {
                corpusHealthBar.classList.add('progress-bar-warning');
                healthStatusText = "Needs Attention! Almost there! 💡";
            }
            corpusHealthText.textContent = `Corpus Health: ${healthStatusText} (${Math.round(healthPercentage)}% of target)`;

            // Update Monthly Expense Breakdown (Bar Chart)
            renderExpenseChart(projectedMonthlyExpensesRetired, travelCostAmount, diningOutCostAmount, hobbiesCostAmount, futureMonthlyBaseExpenses);

            // Update Simulated Retirement Day Scenario
            renderRetirementDayScenario(cityChoice, travelFrequency, diningOut, hobbiesLevel, projectedMonthlyExpensesRetired);

            // Update AI Nudge & Investment Options
            renderAiNudge(corpusNeeded, projectedCorpus, yearsToRetirement, cityChoice, travelFrequency, diningOut, hobbiesLevel);
        }

        // --- Chart Rendering ---
        function renderExpenseChart(totalMonthlyExpenses, travelCost, diningOutCost, hobbiesCost, baseMonthlyExpenses) {
            const dynamicExpenses = {
                'Housing 🏠': baseMonthlyExpenses * BASE_EXPENSE_PROPORTIONS.Housing,
                'Food 🍎': baseMonthlyExpenses * BASE_EXPENSE_PROPORTIONS['Food & Groceries'],
                'Utilities 💡': baseMonthlyExpenses * BASE_EXPENSE_PROPORTIONS['Utilities & Transport'],
                'Healthcare ❤️': baseMonthlyExpenses * BASE_EXPENSE_PROPORTIONS['Healthcare Buffer'],
                'Travel ✈️': travelCost,
                'Dining/Fun 🥳': diningOutCost,
                'Hobbies 🎨': hobbiesCost,
                'Misc. 🛒': baseMonthlyExpenses * BASE_EXPENSE_PROPORTIONS.Miscellaneous
            };

            expenseChart.innerHTML = ''; // Clear previous bars
            expenseLabelsContainer.innerHTML = ''; // Clear previous labels

            let maxExpenseValue = 0;
            for (const category in dynamicExpenses) {
                if (dynamicExpenses[category] > maxExpenseValue) {
                    maxExpenseValue = dynamicExpenses[category];
                }
            }
            if (maxExpenseValue === 0) maxExpenseValue = 1; // Avoid division by zero

            const categoriesOrdered = ['Housing 🏠', 'Food 🍎', 'Utilities 💡', 'Healthcare ❤️', 'Travel ✈️', 'Dining/Fun 🥳', 'Hobbies 🎨', 'Misc. 🛒'];


            for (const category of categoriesOrdered) {
                const value = dynamicExpenses[category];
                const heightPercentage = (value / maxExpenseValue) * 90; // Max height 90%

                const bar = document.createElement('div');
                bar.className = 'chart-bar flex items-center justify-center';
                bar.style.height = `${Math.max(5, heightPercentage)}%`; // Min height for visibility

                const valueSpan = document.createElement('span');
                valueSpan.className = 'chart-bar-value';
                valueSpan.textContent = formatRupees(value);
                bar.appendChild(valueSpan);

                expenseChart.appendChild(bar);

                // Add labels separately for better control
                const labelDiv = document.createElement('div');
                labelDiv.className = 'text-center text-gray-700 text-xs font-medium flex-shrink-0'; // flex-shrink-0 to prevent shrinking
                labelDiv.style.width = `calc(100% / ${categoriesOrdered.length} - 0.5rem)`; // Ensure consistent spacing as above
                labelDiv.textContent = category.split(' ')[0]; // Show only first word
                expenseLabelsContainer.appendChild(labelDiv);
            }
             // Ensure the label container takes full width to align labels correctly
             expenseLabelsContainer.style.width = '100%';
             expenseLabelsContainer.style.justifyContent = 'space-around'; // Match chart justification
        }

        // --- Scenario Generation ---
        function renderRetirementDayScenario(city, travel, dining, hobbies, monthlyExpenses) {
            let cityDisplay = city.replace('-', ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            if (city === 'small-town') cityDisplay = 'Mountains'; // Special case for display title
            if (city === 'goa') cityDisplay = 'Beach'; // Special case for display title
            if (city === 'pune') cityDisplay = 'Tier-2 City'; // Special case for display title
            if (city === 'bengaluru') cityDisplay = 'City'; // Special case for display title


            let scenarioElements = [];

            scenarioElements.push({ emoji: '🧘‍♀️', text: `Imagine a vibrant day in your retired life in <strong>${cityDisplay}</strong>...` });

            let morningActivity = "";
            if (hobbies === 'high') {
                morningActivity = "Your mornings are dedicated to deep dives into your passions, maybe a painting session or coding new projects. Pure bliss!";
            } else if (hobbies === 'medium') {
                morningActivity = "You kickstart your day with a refreshing yoga session, a brisk walk, or a friendly game at your local club.";
            } else { // low hobbies
                morningActivity = "Your mornings are leisurely, perhaps enjoying a hot cup of chai and a good book on your balcony.";
            }
            scenarioElements.push({ emoji: '☀️', text: morningActivity });

            let afternoonActivity = "";
            if (dining === 'high') {
                afternoonActivity = "Lunch often means exploring a new trendy restaurant or catching up with friends over a gourmet meal.";
            } else if (dining === 'medium') {
                afternoonActivity = "You might head out for a delightful lunch at a local cafe, savoring the flavors and atmosphere.";
            } else { // low dining
                afternoonActivity = "Afternoons are peaceful, perhaps preparing a delicious home-cooked meal or tending to your garden.";
            }
            scenarioElements.push({ emoji: '🍽️', text: afternoonActivity });

            let travelContext = "";
            if (travel === 'high') {
                travelContext = "This year, you are packing your bags for an exciting international adventure! ✈️";
            } else if (travel === 'medium') {
                travelContext = "You are always looking forward to your next domestic trip, discovering India's hidden gems! 🚂";
            } else {
                travelContext = "Your days are perfectly balanced with local discoveries and comfortable routines. 🚶‍♀️";
            }
            scenarioElements.push({ emoji: '🗓️', text: travelContext });

            let eveningActivity = "";
            if (dining === 'high' && hobbies === 'high') {
                 eveningActivity = "Evenings might bring you to a live concert, a theatre play, or a vibrant social gathering, followed by an exquisite dinner.";
            } else if (dining === 'high' || hobbies === 'high') {
                eveningActivity = "You wrap up your day with either a delightful dinner out or immersing yourself in your favorite hobby.";
            } else if (dining === 'medium') {
                 eveningActivity = "Evenings often involve relaxed dinners at home, perhaps with a quiet movie or catching up with loved ones.";
            } else {
                eveningActivity = "Your evenings are calm and cozy, cherishing quiet moments and family time.";
            }
            scenarioElements.push({ emoji: '🌙', text: eveningActivity });

            scenarioElements.push({ emoji: '💵', text: `This amazing lifestyle translates to an estimated monthly spend of <strong>${formatRupees(monthlyExpenses)}</strong>.` });

            retirementDayScenario.innerHTML = ''; // Clear previous
            scenarioElements.forEach(item => {
                const div = document.createElement('div');
                div.className = 'scenario-item';
                div.innerHTML = `<span class="text-2xl">${item.emoji}</span><p>${item.text}</p>`;
                retirementDayScenario.appendChild(div);
            });
        }

        // --- AI Nudge Logic ---
        const investmentOptions = [
            { id: 'fractional', title: 'Fractional Investments', img: 'https://placehold.co/60x60/f87171/FFF?text=FI', description: 'High Growth Potential, Diverse Assets', currentAllocation: 0 },
            { id: 'mutual-funds', title: 'Mutual Funds', img: 'https://placehold.co/60x60/34d399/FFF?text=MF', description: 'Professionally Managed, Diversified', currentAllocation: 0 },
            { id: 'gold', title: 'Gold', img: 'https://placehold.co/60x60/fbbf24/000?text=Gold', description: 'Inflation Hedge, Safe Haven', currentAllocation: 0 },
            { id: 'crypto', title: 'Crypto', img: 'https://placehold.co/60x60/818cf8/FFF?text=Crypto', description: 'Emerging Digital Assets, Volatile', currentAllocation: 0 },
            { id: 'nft', title: 'NFTs', img: 'https://placehold.co/60x60/c084fc/FFF?text=NFT', description: 'Digital Collectibles, Unique Value', currentAllocation: 0 }
        ];

        function renderInvestmentCards(allocations) {
            investmentOptionsContainer.innerHTML = ''; // Clear previous cards
            investmentOptions.forEach(option => {
                const card = document.createElement('div');
                card.className = 'investment-card';
                card.innerHTML = `
                    <img src="${option.img}" alt="${option.title}">
                    <div class="investment-card-title">${option.title}</div>
                    <div class="investment-card-value">${allocations[option.id]}%</div>
                    <button class="investment-card-button" data-category="${option.id}">Find Options</button>
                `;
                investmentOptionsContainer.appendChild(card);
            });

            // Add event listeners to new buttons
            investmentOptionsContainer.querySelectorAll('.investment-card-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const category = event.target.dataset.category;
                    showMarketplaceOptions(category);
                });
            });
        }

        function autoAdjustAllocation() {
            const yearsToRetirement = parseInt(retirementAgeInput.value) - parseInt(currentAgeInput.value);
            let allocations = {};
            let remainingPercentage = 100;

            // Logic for simplified risk profiling based on years to retirement
            if (yearsToRetirement > 20) { // Younger, more aggressive
                allocations = {
                    'fractional': 20, 'mutual-funds': 40, 'gold': 10, 'crypto': 20, 'nft': 10
                };
            } else if (yearsToRetirement > 10) { // Mid-career, balanced
                allocations = {
                    'fractional': 15, 'mutual-funds': 55, 'gold': 15, 'crypto': 10, 'nft': 5
                };
            } else { // Closer to retirement, more conservative
                allocations = {
                    'fractional': 5, 'mutual-funds': 65, 'gold': 20, 'crypto': 5, 'nft': 5
                };
            }

            // Render updated cards
            renderInvestmentCards(allocations);
            marketplaceResultsDisplay.classList.add('hidden'); // Hide marketplace results on re-adjustment
        }

        function showMarketplaceOptions(category) {
            marketplaceResultsDisplay.classList.remove('hidden');
            let resultText = `Searching for top <strong>${category.replace('-', ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</strong> investment options...<br><br>`;
            
            // Mock data for marketplace results
            const marketplaceData = {
                'fractional': [
                    "AssetY - Commercial Real Estate (Delhi)",
                    "ArtFolio - Rare Indian Art Collection",
                    "GrowVest - Pre-IPO Startup Shares"
                ],
                'mutual-funds': [
                    "Axis Bluechip Fund - Direct Growth",
                    "Parag Parikh Flexi Cap Fund - Direct Growth",
                    "ICICI Prudential Nifty Next 50 Index Fund"
                ],
                'gold': [
                    "MMTC-PAMP Digital Gold",
                    "HDFC Gold ETF",
                    "Sovereign Gold Bond (RBI)"
                ],
                'crypto': [
                    "Bitcoin (BTC) - via CoinDCX",
                    "Ethereum (ETH) - via WazirX",
                    "Polygon (MATIC) - via ZebPay"
                ],
                'nft': [
                    "Indian Digital Art Collection (Platform A)",
                    "Sports Memorabilia NFTs (Platform B)",
                    "Emerging Creator Series (Platform C)"
                ]
            };

            resultText += `Here are some popular options for <strong>${category.replace('-', ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</strong>:<br><ul>`;
            marketplaceData[category].forEach(item => {
                resultText += `<li>• ${item}</li>`;
            });
            resultText += `</ul><br>Connecting you to the right platforms for these! 🚀`;

            marketplaceResultsDisplay.innerHTML = resultText;
        }


        function renderAiNudge(corpusNeeded, projectedCorpus, yearsToRetirement, cityChoice, travelFrequency, diningOut, hobbiesLevel) {
            aiNudgeArea.classList.remove('hidden');
            let nudgeText = "";

            if (projectedCorpus >= corpusNeeded) {
                nudgeText = "You are smashing your retirement goals! Your plan is on track to fund your desired lifestyle with confidence. Keep up the brilliant work! 🎉";
            } else {
                const deficit = corpusNeeded - projectedCorpus;
                let monthlySIPNeeded = 0;
                if (yearsToRetirement > 0) {
                    monthlySIPNeeded = (deficit * (PRE_RETIREMENT_RETURN_RATE / 12)) / (Math.pow(1 + (PRE_RETIREMENT_RETURN_RATE / 12), yearsToRetirement * 12) - 1);
                } else {
                    monthlySIPNeeded = deficit; // If no time, need entire deficit as lump sum
                }

                nudgeText = `Your current path shows a gap of <strong>${formatCurrency(deficit)}</strong>. To truly live your dream, RetireSaathi suggests you consider:`;

                let specificSuggestions = [];

                if (monthlySIPNeeded > 50000 && yearsToRetirement < 10) { // Large gap, short time
                    specificSuggestions.push(`Boosting your monthly savings by around <strong>${formatRupees(monthlySIPNeeded)}</strong>. It's a significant leap, but your dream retirement is worth it!`);
                    specificSuggestions.push(`Exploring extending your working years by 2-5 years to build more corpus. Every extra year can make a remarkable difference!`);
                } else if (monthlySIPNeeded > 10000 && yearsToRetirement >= 10) { // Moderate gap, decent time
                    specificSuggestions.push(`Increasing your monthly savings by approximately <strong>${formatRupees(monthlySIPNeeded)}</strong>. Small, consistent increases today can lead to big rewards tomorrow!`);
                } else if (monthlySIPNeeded > 0) { // Small gap
                    specificSuggestions.push(`Adding just <strong>${formatRupees(monthlySIPNeeded)}</strong> to your monthly savings to comfortably bridge the gap. You're so close to unlocking your dream!`);
                }

                // Lifestyle-specific nudges
                if (travelFrequency === 'high' && deficit > 0) {
                    specificSuggestions.push(`Rethinking global adventures for a few years and focusing on amazing domestic travel could save you significantly. Think incredible Indian destinations! ✈️➡️🚂`);
                }
                if (diningOut === 'high' && deficit > 0) {
                    specificSuggestions.push(`Balancing fine dining with more home-cooked gourmet meals can free up substantial funds for your long-term goals. Enjoying both worlds! 🍽️🏠`);
                }
                if (hobbiesLevel === 'high' && deficit > 0) {
                    specificSuggestions.push(`Exploring more budget-friendly passion pursuits or finding creative ways to monetize your immersive hobbies could give your corpus a boost! 🎨💰`);
                }
                if (cityChoice === 'bengaluru' && deficit > 0) {
                     specificSuggestions.push(`Considering a move to a beautiful Tier-2 city like Pune or a peaceful small town/hill station upon retirement could significantly reduce living costs and stretch your corpus further! 🏙️➡️🏞️`);
                }

                if (specificSuggestions.length === 0 && deficit > 0) { // Generic if no specific lifestyle nudge applies
                    specificSuggestions.push(`Boosting your monthly savings consistently. Every little bit truly helps!`);
                }

                aiNudgeText.innerHTML = nudgeText + (specificSuggestions.length > 0 ? `<ul>` + specificSuggestions.map(s => `<li>• ${s}</li>`).join('') + `</ul>` : '');
            }
            // Initial render of investment cards with a default allocation (e.g., balanced)
            autoAdjustAllocationBtn.addEventListener('click', autoAdjustAllocation);
            const initialAllocations = {
                'fractional': 10, 'mutual-funds': 60, 'gold': 15, 'crypto': 10, 'nft': 5
            };
            renderInvestmentCards(initialAllocations);
        }

        // --- Event Listeners and Initialization ---
        // Event listener for the simulate button (redundant with live updates, but kept for explicit trigger)
        simulateBtn.addEventListener('click', updateSimulation);

        // Add event listeners for input changes to trigger instant updates
        const sliderInputs = [
            currentAgeInput, retirementAgeInput, lifeExpectancyInput,
            monthlyExpensesInput, existingCorpusInput
        ];

        sliderInputs.forEach(input => {
            input.addEventListener('input', updateSimulation); // 'input' event for live updates on sliders
        });

        // Run simulation on page load with default values
        document.addEventListener('DOMContentLoaded', () => {
            updateSimulation(); // Perform initial simulation
        });
    </script>
</body>
</html>
